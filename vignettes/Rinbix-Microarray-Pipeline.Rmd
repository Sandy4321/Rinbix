---
title: "Rinbix Microarray Pipeline"
author: "Bill White"
date: "October 27, 2015"
output: html_document
---

```{r, echo=FALSE, message=FALSE}
library(affy)
library(affyPLM)
library(leukemiasEset)
library(ggplot2)
library(clusterProfiler)
library(broom)
library(biomaRt)
library(Rinbix)
```

#Get Leukemias Data

```{r}
data(leukemiasEset)  # load bone marrow samples
# quantiles function needs eset to operate on
leukExprData_quantile <- normalize.ExpressionSet.quantiles(leukemiasEset, transfn="log")
leukExprData_quantileLog2 <- log2(exprs(leukExprData_quantile))
#dim(leukemiasEset) # 20172 genes x 60 samples
#sampleNames(leukemiasEset) # cell file names
#featureNames(leukemiasEset)[1:5] # first 5 gene ensemble ids
allPheno <- pData(leukemiasEset)
# abbreviated leukemia types
leukPheno <- allPheno$LeukemiaType  
# ALL AML CLL CML NoL 
# 12  12  12  12  12 
colnames(leukExprData_quantileLog2) <- leukPheno
```

#Gene Filters

```{r}
lvalf <- geneLowValueFilter(leukExprData_quantileLog2, 0.8)
lvarf <- geneLowVarianceFilter(lvalf$fdata, 0.8)
geneFilteredData <- as.data.frame(t(lvarf$fdata))
geneFilteredData$Class <- ifelse(leukPheno == "NoL", 0, 1)
```

#Rankers

```{r}
ttestResults <- rankTTest(geneFilteredData)
print(head(ttestResults))

dcgainSnprankResults <- rankDcgainSnprank(geneFilteredData)
print(head(dcgainSnprankResults))

reliefseqRanks <- rankReliefSeq(geneFilteredData)
print(head(reliefseqRanks))
```

```{r, echo=FALSE}
allResults <- data.frame(ttest=sort(1-ttestResults), 
                         dcgain=sort(dcgainSnprankResults$snprank), 
                         relieff=sort(reliefseqRanks$score))
x <- 1:nrow(allResults)
plot(x, allResults$ttest, col="red", pch=16, main="Rankers")
points(x, allResults$dcgain, pch=16, col="blue")
points(x, allResults$relieff, pch=16, col="magenta")
legend("topleft", c("1 - t-test", "dcGAIN+SNPrank", "ReliefSeq"), 
       col=c("red", "blue", "magenta"), pch=rep(16, 3))
```
